(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();function w(n){return n==="×"?"*":n==="÷"?"/":n==="−"?"-":n}const h={"+":1,"-":1,"*":2,"/":2,"%":2,"^":3,"u-":4},g={"+":!1,"-":!1,"*":!1,"/":!1,"%":!1,"^":!0,"u-":!0};function y(n){const e=[];let r=0;const o=n.trim().replace(/\s+/g,"");if(o.length===0)return[];for(;r<o.length;){const t=o[r];if(/[0-9.]/.test(t)){let s=r,a=0;for(;s<o.length&&/[0-9.]/.test(o[s]);)o[s]==="."&&a++,s++;if(a>1)throw new Error("Некорректное число: более одной десятичной точки.");const p=o.substring(r,s),c=parseFloat(p);if(isNaN(c))throw new Error("Некорректное число");e.push(c),r=s;continue}const i=w(t);switch(i){case"+":case"*":case"/":case"%":case"^":case"(":case")":e.push(i),r++;break;case"-":const s=e.length>0?e[e.length-1]:void 0;e.length===0||s==="("||typeof s=="string"&&["+","-","*","/","%","^"].includes(s)?e.push("u-"):e.push("-"),r++;break;default:throw new Error(`Неизвестный символ: ${t}`)}}return e}function E(n){const e=[],r=[];for(const o of n)if(typeof o=="number")e.push(o);else if(o==="(")r.push(o);else if(o===")"){let t=!1;for(;r.length>0&&r[r.length-1]!=="(";)e.push(r.pop());if(r.length>0&&r[r.length-1]==="("&&(r.pop(),t=!0),!t)throw new Error("Несогласованные скобки: отсутствует открывающая скобка.")}else{const t=o;for(;r.length>0&&r[r.length-1]!=="("&&(h[r[r.length-1]]>h[t]||h[r[r.length-1]]===h[t]&&!g[t]);)e.push(r.pop());r.push(t)}for(;r.length>0;){const o=r.pop();if(o==="("||o===")")throw new Error("Несогласованные скобки: отсутствует закрывающая скобка.");e.push(o)}return e}function b(n){const e=[];for(const o of n)if(typeof o=="number")e.push(o);else{let t,i;switch(o){case"u-":if(e.length<1)throw new Error("Недостаточно операндов для унарного минуса.");i=e.pop(),e.push(-i);break;case"+":case"-":case"*":case"/":case"%":case"^":if(e.length<2)throw new Error(`Недостаточно операндов для операции ${o}.`);t=e.pop(),i=e.pop();let s;switch(o){case"+":s=i+t;break;case"-":s=i-t;break;case"*":s=i*t;break;case"/":if(t===0)throw new Error("Деление на ноль.");s=i/t;break;case"%":s=i%t;break;case"^":if(s=Math.pow(i,t),!Number.isFinite(s))throw new Error("Некорректное вычисление степени.");break;default:throw new Error(`Неподдерживаемая операция: ${o}.`)}e.push(s);break;default:throw new Error(`Неизвестный токен в RPN: ${o}.`)}}if(e.length!==1)throw new Error("Некорректное выражение: осталось более одного элемента в стеке после вычисления RPN.");const r=e[0];if(!Number.isFinite(r))throw new Error("Результат вычисления не является конечным числом.");return r}function x(n){const e=y(n);if(e.length===0)throw new Error("Пустое выражение");const r=e[0];if(typeof r=="string"&&!["u-","("].includes(r))throw new Error("Выражение должно начинаться с числа, унарного минуса или открывающей скобки.");const o=E(e);return b(o)}function N(n){try{const e=x(n);if(Number.isInteger(e))return e.toString();const r=e.toFixed(12);return parseFloat(r).toString()}catch{return"Error"}}const m="https://calculator2-9ae5.onrender.com/api";async function C(){try{const n=await fetch(`${m}/history`);return n.ok?await n.json():[]}catch(n){return console.error("fetchHistory error",n),[]}}async function d(n){try{await fetch(`${m}/history`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(e){console.error("postHistory error",e)}}document.addEventListener("DOMContentLoaded",async()=>{const n=document.getElementById("display"),e=document.getElementById("history-list"),r=document.getElementById("buttons-area");n.textContent="0",(await C()).forEach(i=>{const s=document.createElement("li");s.textContent=`${i.expression} = ${i.result}`,e.prepend(s)});let t="";r.addEventListener("click",async i=>{var p;const s=i.target;if(!s||s.tagName!=="BUTTON")return;const a=((p=s.textContent)==null?void 0:p.trim())??"";if(!isNaN(Number(a))||a==="."){t+=a,n.textContent=t||"0";return}if(["+","−","×","÷","^","%","-","*","/"].includes(a)){t=t.trimEnd(),t+=" "+a+" ",n.textContent=t;return}if(a==="="){if(!t)return;const c=N(t);n.textContent=c,await d({expression:t,result:c,timestamp:new Date().toISOString()});const l=document.createElement("li");l.textContent=`${t} = ${c}`,e.prepend(l),t=c==="Error"?"":c;return}if(a==="C"||a==="C/CE"){t="",n.textContent="0";return}if(a==="OFF"){n.textContent="";return}if(a==="√"){const c=parseFloat(n.textContent||"0"),l=Number.isFinite(c)?Math.sqrt(c):NaN,u=Number.isFinite(l)?l.toString():"Error";t=u,n.textContent=u,await d({expression:`√(${c})`,result:u,timestamp:new Date().toISOString()});const f=document.createElement("li");f.textContent=`√(${c}) = ${u}`,e.prepend(f);return}if(a==="%"){const c=parseFloat(n.textContent||"0"),l=c/100,u=isFinite(l)?l.toString():"Error";t=u,n.textContent=u,await d({expression:`${c}%`,result:u,timestamp:new Date().toISOString()});const f=document.createElement("li");f.textContent=`${c}% = ${u}`,e.prepend(f);return}a.startsWith("M")})});
