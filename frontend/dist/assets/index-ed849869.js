(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function c(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(e){if(e.ep)return;e.ep=!0;const s=c(e);fetch(e.href,s)}})();function m(o){const i=o.replace(/\s+/g,"");if(i.length===0)throw new Error("Пустое выражение");const c=[];let a=0;const e=()=>{let t=a;for(i[t]==="-"&&t++;t<i.length&&/[0-9.]/.test(i[t]);)t++;const l=i.substring(a,t),n=parseFloat(l);if(isNaN(n))throw new Error("Некорректное число");return a=t,n},s=e();for(c.push(s);a<i.length;){const t=i[a];if(!["+","-","*","/","%","^"].includes(t)){if(t==="×"){c.push("*"),a++;continue}if(t==="÷"){c.push("/"),a++;continue}if(t==="−"){c.push("-"),a++;continue}throw new Error(`Неизвестная операция: ${t}`)}c.push(t),a++;const l=e();c.push(l)}let r=Number(c[0]);for(let t=1;t<c.length;t+=2){const l=c[t],n=Number(c[t+1]);switch(l){case"+":r=r+n;break;case"-":r=r-n;break;case"*":r=r*n;break;case"/":if(n===0)throw new Error("Деление на ноль");r=r/n;break;case"%":r=r%n;break;case"^":r=Math.pow(r,n);break;default:throw new Error(`Неподдерживаемая операция: ${l}`)}}if(!isFinite(r))throw new Error("Некорректное вычисление");return r}function y(o){try{return m(o).toString()}catch{return"Error"}}const h={}.VITE_API_BASE_URL||"http://localhost:8000/api";async function E(){const o=await fetch(`${h}/history`);return o.ok?o.json():[]}async function p(o){await fetch(`${h}/history`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}document.addEventListener("DOMContentLoaded",async()=>{const o=document.getElementById("display"),i=document.getElementById("history-list"),c=document.querySelector(".buttons");(await E()).forEach(s=>{const r=document.createElement("li");r.textContent=`${s.expression} = ${s.result}`,i.prepend(r)});let e="";c.addEventListener("click",async s=>{var l;const r=s.target;if(!r||r.tagName!=="BUTTON")return;const t=((l=r.textContent)==null?void 0:l.trim())??"";if(!isNaN(Number(t))||t==="."){e+=t,o.textContent=e||"0";return}if(["+","−","×","÷","^"].includes(t)){e+=" "+t+" ",o.textContent=e;return}if(t==="="){if(!e)return;const n=y(e);o.textContent=n,await p({expression:e,result:n});const u=document.createElement("li");u.textContent=`${e} = ${n}`,i.prepend(u),e=n==="Error"?"":n;return}if(t==="C"||t==="C/CE"){e="",o.textContent="0";return}if(t==="OFF"){o.textContent="";return}if(t==="√"){const n=parseFloat(o.textContent||"0"),f=Number.isFinite(n)?Math.sqrt(n):NaN,u=Number.isFinite(f)?f.toString():"Error";e=u,o.textContent=u,await p({expression:`√(${n})`,result:u});const d=document.createElement("li");d.textContent=`√(${n}) = ${u}`,i.prepend(d);return}if(t==="%"){const n=parseFloat(o.textContent||"0"),f=n/100,u=isFinite(f)?f.toString():"Error";e=u,o.textContent=u,await p({expression:`${n}%`,result:u});const d=document.createElement("li");d.textContent=`${n}% = ${u}`,i.prepend(d);return}t.startsWith("M")})});
