(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();function y(n){return n==="×"?"*":n==="÷"?"/":n==="−"?"-":n}const m={"+":1,"-":1,"*":2,"/":2,"%":2,"^":3,"u-":4},E={"+":!1,"-":!1,"*":!1,"/":!1,"%":!1,"^":!0,"u-":!0};function b(n){const e=[];let r=0;const o=n.trim().replace(/\s+/g,"");if(o.length===0)return[];for(;r<o.length;){const t=o[r];if(/[0-9.]/.test(t)){let i=r,l=0;for(;i<o.length&&/[0-9.]/.test(o[i]);)o[i]==="."&&l++,i++;if(l>1)throw new Error("Некорректное число: более одной десятичной точки.");const c=o.substring(r,i),p=parseFloat(c);if(isNaN(p))throw new Error("Некорректное число");e.push(p),r=i;continue}const s=y(t);switch(s){case"+":case"*":case"/":case"%":case"^":case"(":case")":e.push(s),r++;break;case"-":const i=e.length>0?e[e.length-1]:void 0;e.length===0||i==="("||typeof i=="string"&&["+","-","*","/","%","^"].includes(i)?e.push("u-"):e.push("-"),r++;break;default:throw new Error(`Неизвестный символ: ${t}`)}}return e}function x(n){const e=[],r=[];for(const o of n)if(typeof o=="number")e.push(o);else if(o==="(")r.push(o);else if(o===")"){let t=!1;for(;r.length>0&&r[r.length-1]!=="(";)e.push(r.pop());if(r.length>0&&r[r.length-1]==="("&&(r.pop(),t=!0),!t)throw new Error("Несогласованные скобки: отсутствует открывающая скобка.")}else{const t=o;for(;r.length>0&&r[r.length-1]!=="("&&(m[r[r.length-1]]>m[t]||m[r[r.length-1]]===m[t]&&!E[t]);)e.push(r.pop());r.push(t)}for(;r.length>0;){const o=r.pop();if(o==="("||o===")")throw new Error("Несогласованные скобки: отсутствует закрывающая скобка.");e.push(o)}return e}function C(n){const e=[];for(const o of n)if(typeof o=="number")e.push(o);else{let t,s;switch(o){case"u-":if(e.length<1)throw new Error("Недостаточно операндов для унарного минуса.");s=e.pop(),e.push(-s);break;case"+":case"-":case"*":case"/":case"%":case"^":if(e.length<2)throw new Error(`Недостаточно операндов для операции ${o}.`);t=e.pop(),s=e.pop();let i;switch(o){case"+":i=s+t;break;case"-":i=s-t;break;case"*":i=s*t;break;case"/":if(t===0)throw new Error("Деление на ноль.");i=s/t;break;case"%":i=s%t;break;case"^":if(i=Math.pow(s,t),!Number.isFinite(i))throw new Error("Некорректное вычисление степени.");break;default:throw new Error(`Неподдерживаемая операция: ${o}.`)}e.push(i);break;default:throw new Error(`Неизвестный токен в RPN: ${o}.`)}}if(e.length!==1)throw new Error("Некорректное выражение: осталось более одного элемента в стеке после вычисления RPN.");const r=e[0];if(!Number.isFinite(r))throw new Error("Результат вычисления не является конечным числом.");return r}function N(n){const e=b(n);if(e.length===0)throw new Error("Пустое выражение");const r=e[0];if(typeof r=="string"&&!["u-","("].includes(r))throw new Error("Выражение должно начинаться с числа, унарного минуса или открывающей скобки.");const o=x(e);return C(o)}function k(n){try{const e=N(n);if(Number.isInteger(e))return e.toString();const r=e.toFixed(12);return parseFloat(r).toString()}catch{return"Error"}}const g="https://calculator2-9ae5.onrender.com/api";async function O(){try{const n=await fetch(`${g}/history`);return n.ok?await n.json():[]}catch(n){return console.error("fetchHistory error",n),[]}}async function w(n){try{await fetch(`${g}/history`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(e){console.error("postHistory error",e)}}document.addEventListener("DOMContentLoaded",async()=>{const n=document.getElementById("display"),e=document.getElementById("history-list"),r=document.getElementById("buttons-area");n.textContent="0",(await O()).forEach(i=>{const l=document.createElement("li");l.textContent=`${i.expression} = ${i.result}`,e.prepend(l)});let t="";const s=document.getElementById("ce-btn");s==null||s.addEventListener("click",()=>{t="",n.textContent="0"}),r.addEventListener("click",async i=>{var p;const l=i.target;if(!l||l.tagName!=="BUTTON")return;const c=((p=l.textContent)==null?void 0:p.trim())??"";if(!isNaN(Number(c))||c==="."){t+=c,n.textContent=t||"0";return}if(["+","−","×","÷","^","%","-","*","/"].includes(c)){t=t.trimEnd(),t+=" "+c+" ",n.textContent=t;return}if(c==="="){if(!t)return;const a=k(t);n.textContent=a;const f={expression:t,result:a,timestamp:new Date().toISOString()};await w(f);const u=document.createElement("li");u.textContent=`${t} = ${a}`,e.prepend(u),t=a==="Error"?"":a;return}if(c==="C"||c==="C/CE"){t="",n.textContent="0";return}if(c==="CE"){t="",n.textContent="0";return}if(c==="OFF"){n.textContent="";return}if(c==="√"){const a=parseFloat(n.textContent||"0"),f=Number.isFinite(a)?Math.sqrt(a):NaN,u=Number.isFinite(f)?f.toString():"Error";t=u,n.textContent=u;const h=`√(${a})`;await w({expression:h,result:u,timestamp:new Date().toISOString()});const d=document.createElement("li");d.textContent=`${h} = ${u}`,e.prepend(d);return}if(c==="%"){const a=parseFloat(n.textContent||"0"),f=a/100,u=isFinite(f)?f.toString():"Error";t=u,n.textContent=u;const h=`${a}%`;await w({expression:h,result:u,timestamp:new Date().toISOString()});const d=document.createElement("li");d.textContent=`${h} = ${u}`,e.prepend(d);return}c.startsWith("M")})});
